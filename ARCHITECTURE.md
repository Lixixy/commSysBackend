# 系统架构说明

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    客户端层 (Client Layer)                    │
├─────────────────────────────────────────────────────────────┤
│  Web浏览器 / 移动应用 / 第三方系统                              │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   控制器层 (Controller Layer)                 │
├─────────────────────────────────────────────────────────────┤
│  UserController    ConfigController    SystemController     │
│  - 用户管理API      - 配置管理API        - 系统信息API         │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    服务层 (Service Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  UserService       ConfigService                            │
│  - 用户业务逻辑      - 配置业务逻辑                           │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   数据访问层 (Repository Layer)                │
├─────────────────────────────────────────────────────────────┤
│  UserRepository    ConfigRepository    BaseRepository       │
│  - 用户数据访问      - 配置数据访问        - 通用数据访问        │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    实体层 (Entity Layer)                      │
├─────────────────────────────────────────────────────────────┤
│  User              Config              BaseEntity           │
│  - 用户实体         - 配置实体           - 基础实体            │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据库层 (Database Layer)                  │
├─────────────────────────────────────────────────────────────┤
│  MySQL 8.0         SQLite 3.44                             │
│  - 生产环境          - 开发/测试环境                          │
└─────────────────────────────────────────────────────────────┘
```

## 核心组件

### 1. 控制器层 (Controller Layer)
- **UserController**: 处理用户相关的HTTP请求
- **ConfigController**: 处理配置管理相关的HTTP请求
- **SystemController**: 处理系统信息和健康检查请求

### 2. 服务层 (Service Layer)
- **UserService**: 用户业务逻辑处理
- **ConfigService**: 配置管理业务逻辑处理

### 3. 数据访问层 (Repository Layer)
- **BaseRepository**: 提供通用的数据访问方法
- **UserRepository**: 用户数据访问接口
- **ConfigRepository**: 配置数据访问接口

### 4. 实体层 (Entity Layer)
- **BaseEntity**: 所有实体的基础类，包含公共字段
- **User**: 用户实体
- **Config**: 配置实体

### 5. 配置层 (Configuration Layer)
- **DatabaseConfig**: 数据库配置，支持MySQL和SQLite动态切换
- **AppConfig**: 应用配置管理
- **WebConfig**: Web相关配置
- **StartupConfig**: 启动时配置初始化

### 6. 通用组件 (Common Components)
- **Result**: 统一响应封装
- **ResultCode**: 响应码枚举
- **PageResult**: 分页结果封装
- **BusinessException**: 业务异常类
- **GlobalExceptionHandler**: 全局异常处理器

## 数据流

### 1. 请求处理流程
```
HTTP请求 → Controller → Service → Repository → Database
                ↓
HTTP响应 ← Controller ← Service ← Repository ← Database
```

### 2. 异常处理流程
```
异常发生 → GlobalExceptionHandler → 统一错误响应
```

### 3. 配置管理流程
```
配置请求 → ConfigController → ConfigService → ConfigRepository → Database
                ↓
配置响应 ← ConfigController ← ConfigService ← ConfigRepository ← Database
```

## 设计模式

### 1. 分层架构模式
- 控制器层、服务层、数据访问层分离
- 每层只依赖下一层，降低耦合度

### 2. 仓储模式 (Repository Pattern)
- 封装数据访问逻辑
- 提供统一的数据访问接口

### 3. 服务层模式 (Service Layer Pattern)
- 封装业务逻辑
- 提供事务管理

### 4. 策略模式 (Strategy Pattern)
- 数据库类型动态切换
- 配置类型处理

### 5. 模板方法模式 (Template Method Pattern)
- BaseEntity提供通用字段和方法
- BaseRepository提供通用数据访问方法

## 技术特性

### 1. 数据库支持
- **MySQL**: 生产环境推荐
- **SQLite**: 开发测试环境
- **动态切换**: 运行时切换数据库类型

### 2. 配置管理
- **静态配置**: application.yml配置文件
- **动态配置**: 数据库存储，支持运行时修改
- **配置分组**: 按功能模块分组管理
- **配置类型**: 支持字符串、数字、布尔值、JSON

### 3. 数据验证
- **JSR-303验证**: 使用@Valid注解
- **自定义验证**: 业务逻辑验证
- **统一异常处理**: 全局异常处理器

### 4. 分页查询
- **Spring Data分页**: 支持分页和排序
- **条件查询**: 支持多条件组合查询
- **统一分页响应**: PageResult封装

### 5. 逻辑删除
- **软删除**: 数据不物理删除，只标记删除状态
- **数据恢复**: 支持恢复已删除的数据
- **查询过滤**: 自动过滤已删除的数据

## 扩展性设计

### 1. 实体扩展
- 继承BaseEntity获得通用功能
- 添加自定义字段和方法

### 2. 服务扩展
- 实现新的Service类
- 注入依赖的Repository

### 3. 控制器扩展
- 创建新的Controller类
- 注入依赖的Service

### 4. 配置扩展
- 添加新的配置分组
- 实现配置的动态加载

### 5. 数据库扩展
- 支持新的数据库类型
- 实现数据库特定的配置

## 性能优化

### 1. 连接池配置
- 使用HikariCP连接池
- 优化连接池参数

### 2. 查询优化
- 使用索引优化查询
- 避免N+1查询问题

### 3. 缓存策略
- 配置信息缓存
- 查询结果缓存

### 4. 异步处理
- 支持异步方法调用
- 提高系统响应性能

## 安全考虑

### 1. 输入验证
- 参数校验和类型检查
- SQL注入防护

### 2. 异常处理
- 不暴露敏感信息
- 统一错误响应格式

### 3. 数据保护
- 逻辑删除保护数据
- 事务管理保证数据一致性

### 4. 配置安全
- 敏感配置加密存储
- 配置访问权限控制
